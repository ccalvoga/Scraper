<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WEB Scraper</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>WEB Scraper</h1>
        <div class="main-controls">
            <button id="start-scrape">Iniciar Scraping</button>
            <button id="cancel-scrape" style="display: none;">Cancelar</button>
            <button id="reload-files">Recargar Ficheros</button>
            <button id="toggle-config">‚öôÔ∏è Configuraci√≥n Avanzada</button>
            <div class="execution-selector">
                <label for="execution-selector">Ejecuci√≥n:</label>
                <select id="execution-selector">
                    <option value="__live">Actual</option>
                </select>
            </div>
            <span id="scrape-status"></span>
        </div>

        <!-- Panel de Configuraci√≥n Avanzada (oculto por defecto) -->
        <div id="config-panel" class="config-panel" style="display: none;">
            <h2>‚öôÔ∏è Configuraci√≥n de Scraping</h2>

            <div class="config-section">
                <h3>üìä Control de Profundidad</h3>
                <div class="config-row">
                    <label for="max-depth">Profundidad M√°xima:</label>
                    <input type="number" id="max-depth" value="3" min="0" max="10">
                    <span class="help-text">Niveles de enlaces a seguir (0 = solo URLs iniciales)</span>
                </div>
            </div>

            <div class="config-section">
                <h3>üîç Comportamiento sin T√©rminos de Inter√©s</h3>
                <div class="config-row">
                    <label>
                        <input type="radio" name="crawl-strategy" value="continue" checked>
                        <strong>Continuar crawleando</strong> - Seguir navegando aunque la p√°gina no tenga t√©rminos
                    </label>
                </div>
                <div class="config-row">
                    <label>
                        <input type="radio" name="crawl-strategy" value="stop">
                        <strong>Detener rama</strong> - No seguir enlaces de p√°ginas sin t√©rminos de inter√©s
                    </label>
                </div>
            </div>

            <div class="config-section">
                <h3>üì• Tipos de Archivos a Descargar</h3>
                <div class="config-row">
                    <label>
                        <input type="checkbox" name="file-type" value="documents" checked>
                        Documentos (PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX)
                    </label>
                </div>
                <div class="config-row">
                    <label>
                        <input type="checkbox" name="file-type" value="images">
                        Im√°genes (JPG, PNG, GIF, SVG, WEBP)
                    </label>
                </div>
                <div class="config-row">
                    <label>
                        <input type="checkbox" name="file-type" value="archives">
                        Archivos comprimidos (ZIP, RAR, 7Z, TAR, GZ)
                    </label>
                </div>
                <div class="config-row">
                    <label>
                        <input type="checkbox" name="file-type" value="other">
                        Otros archivos (TXT, CSV, JSON, XML)
                    </label>
                </div>
            </div>

            <div class="config-section">
                <h3>üåê Alcance de Descargas</h3>
                <div class="config-row">
                    <label>
                        <input type="radio" name="download-scope" value="same-domain" checked>
                        <strong>Solo del mismo dominio</strong> - Solo descargar archivos del dominio actual
                    </label>
                </div>
                <div class="config-row">
                    <label>
                        <input type="radio" name="download-scope" value="any-domain">
                        <strong>Cualquier dominio</strong> - Descargar archivos de cualquier URL
                    </label>
                </div>
            </div>

            <div class="config-section">
                <h3>üìÇ Restricci√≥n de Directorio</h3>
                <div class="config-row">
                    <label>
                        <input type="radio" name="path-restriction" value="base-path" checked>
                        <strong>Solo directorio base</strong> - Crawlear solo dentro del path inicial
                    </label>
                </div>
                <div class="config-row">
                    <label>
                        <input type="radio" name="path-restriction" value="same-domain">
                        <strong>Todo el dominio</strong> - Crawlear cualquier URL del mismo dominio
                    </label>
                </div>
                <div class="config-example">
                    Ejemplo: Si URL inicial es <code>/es/energia/renovables/</code>
                    <br>‚Ä¢ Base path: solo <code>/es/energia/renovables/*</code>
                    <br>‚Ä¢ Todo dominio: permite <code>/es/agua/</code>, <code>/en/energy/</code>, etc.
                </div>
            </div>

            <div class="config-section">
                <h3>üíæ Opciones de Guardado</h3>
                <div class="config-row">
                    <label>
                        <input type="checkbox" id="save-page-text" checked>
                        Guardar texto completo de p√°ginas con t√©rminos
                    </label>
                </div>
                <div class="config-row">
                    <label>
                        <input type="checkbox" id="save-html" checked>
                        Guardar HTML original de p√°ginas con t√©rminos
                    </label>
                </div>
            </div>

            <button id="apply-config" class="apply-config-btn">‚úì Aplicar Configuraci√≥n</button>
        </div>

        <div class="main-layout">
            <div class="top-section">
                <!-- Columna 1: Editor de Fuentes -->
                <div id="fuentes-panel" class="layout-panel">
                    <div class="tab-bar">
                        <button class="tab-btn active" data-tab="fuentes-editor-container">Editor</button>
                        <button class="tab-btn" data-tab="fuentes-preview-container">Vista Previa</button>
                    </div>
                    <div id="fuentes-editor-container" class="tab-content active">
                        <textarea id="fuentes-editor"></textarea>
                    </div>
                    <div id="fuentes-preview-container" class="tab-content markdown-body"></div>
                    <div class="editor-actions">
                        <button class="secondary-btn" id="dedupe-fuentes">Limpiar duplicados</button>
                        <span class="editor-feedback" id="dedupe-feedback"></span>
                    </div>
                    <button class="save-btn" data-filename="fuentes.csv">Guardar</button>
                </div>

                <!-- Columna 2: Terminos y Exclusiones -->
                <div class="layout-column">
                    <div id="terminos-panel" class="layout-panel">
                        <h2>T√©rminos de Inter√©s (terminos_interes.txt)</h2>
                        <textarea id="terminos-editor"></textarea>
                        <button class="save-btn" data-filename="terminos_interes.txt">Guardar</button>
                    </div>
                    <div id="exclusiones-panel" class="layout-panel">
                        <h2>Exclusiones (exclusiones.txt)</h2>
                        <textarea id="exclusiones-editor"></textarea>
                        <button class="save-btn" data-filename="exclusiones.txt">Guardar</button>
                    </div>
                </div>

                <!-- Columna 3: Logs -->
                <div id="log-panel" class="layout-panel">
                    <div id="log-resize-handle" class="log-resize-handle" title="Arrastra para cambiar el ancho" role="separator" aria-orientation="vertical"></div>
                    <div class="panel-header">
                        <h2>Log de Actividad</h2>
                        <div class="log-controls">
                            <button class="log-filter-btn active" data-filter="all">Todo</button>
                            <button class="log-filter-btn" data-filter="info">Info</button>
                            <button class="log-filter-btn" data-filter="warning">Warning</button>
                            <button class="log-filter-btn" data-filter="error">Error</button>
                            <button class="log-action-btn" id="log-group-toggle" title="Agrupar por fuente">Agrupar por fuente</button>
                            <button class="log-action-btn" id="log-refresh" title="Recargar log">&#8635;</button>
                            <button class="log-action-btn" id="log-clear" title="Limpiar log">&#10006;</button>
                        </div>
                    </div>
                    <div class="log-meta">
                        <span id="log-last-updated">Actualizado: --</span>
                        <span id="log-entry-count">Entradas: 0</span>
                    </div>
                    <div class="log-body">
                        <div id="log-output" class="log-output"></div>
                    </div>
                </div>
            </div>

            <div class="bottom-section">
                <!-- Fila Inferior: Resultados -->
                <div id="resultados-panel" class="layout-panel">
                    <h2>Resultados (procesados.md)</h2>
                    <div id="procesados-output" class="markdown-body"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/marked.min.js"></script>
    <script src="/static/script.js"></script>
</body>
</html>
